<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ll-token-field/ll-token-field.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="../lodash/lodash.js">

An element for editing property information

<!--
Example:

    <ll-property-information-edit></ll-property-information-edit>

The `ll-property-information-edit` handles creating and editing of property information.

@demo
-->

<dom-module id="ll-property-information-edit">

  <style>
    .help-block {
      display: inline-block;
      margin: 5px 0px;
      font-weight: 100;
    }

    #amenities-input {
      border: 1px solid #ccc;
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: text;
    }

    iron-autogrow-textarea {
      height: 10em;
    }

    .entypo {
      font-size: 3em;
      vertical-align: middle;
   }
  </style>

  <template>
    <form id="post-form">

      <div class="row">
        <div class="form-group col-md-12">
          <label for="name-input" class="required">Property Name <span class="entypo circled-help" data-toggle="tooltip" data-content="Property name will be the identifying name distributed to all marketing channels. For a single property, the address will suffice, or a more creative name may be used."></span></label>
          <input is="iron-input" type="text" bind-value="{{property.name}}" id="name-input" autocomplete="off" class="form-control" required placeholder="Property Name" />
        </div>
      </div>

      <div class="row">
        <div class="form-group col-md-6">
          <label for="address1-input" class="required">Address 1</label>
          <input is="iron-input"type="text" bind-value="{{property.location.address}}" id="address1-input" autocomplete="off" class="form-control" required placeholder="Enter street address"/>
        </div>

        <div class="form-group col-md-6">
          <label for="address2-input">Address 2 <span class="help-block">(Optional)</span></label>
          <input is="iron-input" type="text" bind-value="{{property.location.address2}}" id="address2-input" autocomplete="off" class="form-control" placeholder="Additional address"/>
        </div>
      </div>

      <div class="row">
        <div class="form-group col-md-4">
          <label for="city-input" class="required">City</label>
          <input is="iron-input" type="text" bind-value="{{property.location.city}}" id="city-input" autocomplete="off" class="form-control" required placeholder="Enter city name"/>
        </div>

        <div class="form-group col-md-4">
          <label for="state-input" class="required">State</label>
          <select id="state-input" value="{{property.location.subdivision::change}}" class="form-control" required>
            <option value="" selected="selected" disabled>Select</option>
            <template is="dom-repeat" items="[[_states]]">
              <option selected={{_isState(item)}} value="{{item}}">{{item}}</option>
            </template>
          </select>
        </div>

        <div class="form-group col-md-4">
          <label for="zip-code-input" class="required">Zip Code</label>
          <input is="iron-input" type="text" bind-value="{{property.location.postal}}" id="zip-code-input" autocomplete="off" class="form-control" required pattern="[0-9]{5}" placeholder="Enter zip code"/>
        </div>

      </div>

      <div class="row">
        <div class="form-group col-md-12">
          <label for="description-input" class="required">Description <span class="entypo circled-help" data-toggle="tooltip" data-content="TBD"></span></label>
          <iron-autogrow-textarea id="description-input" class="form-control" placeholder="Enter short description of property" bind-value="{{property.description}}"></iron-autogrow-textarea>
        </div>
      </div>

      <div class="row">
        <div class="form-group col-md-6">
          <label for="bedroom-count-input" class="required">Bedrooms</label>
          <input is="iron-input" type="number" min="0" class="form-control" bind-value="{{property.bedroomCount}}" id="bedroom-count-input" required placeholder="Number of bedrooms" />
        </div>

        <div class="form-group col-md-6">
          <label for="bathroom-count-input" class="required">Bathrooms</label>
          <input is="iron-input" type="number" min="0" step=".25" bind-value="{{property.bathroomCount}}" id="bathroom-count-input" class="form-control" required placeholder="Total number of bathrooms" />
        </div>

      </div>

      <div class="row">
        <div class="form-group col-md-4">
          <label for="full-bathroom-input" class="required">Full Bathrooms</label>
          <input is="iron-input" type="number" min="0" bind-value="{{property.fullBathrooms}}" id="full-bathroom-input" class="form-control" required placeholder="Total number of full bathrooms" />
        </div>

        <div class="form-group col-md-4">
          <label for="three-quarter-bathroom-input" class="required">3/4 Bathrooms</label>
          <input is="iron-input" type="number" min="0" bind-value="{{property.threeQuarterBathrooms}}" id="three-quarter-bathroom-input" class="form-control" required placeholder="Total number of 3/4 bathrooms" />
        </div>

        <div class="form-group col-md-4">
          <label for="half-bathroom-input" class="required">1/2 Bathrooms</label>
          <input is="iron-input" type="number" min="0" bind-value="{{property.halfBathrooms}}" id="half-bathroom-input" class="form-control" required placeholder="Total number of 1/2 bathrooms" />
        </div>
      </div>

      <div class="row">
        <div class="form-group col-md-12">
          <label for="amenities-input">Amenities</label>
          <ll-token-field id="amenities-input" tags={{property.amenities}}></ll-token-field>
        </div>
      </div>

      <div class="row">
        <div class="form-group col-md-4">
          <label for="occupancy-input" class="required">Occupancy</label>
          <input is="iron-input" type="number" min="0" bind-value="{{property.occupancy}}" id="occupancy-input" class="form-control" required placeholder="Maximum occupancy" />
        </div>

        <div class="form-group col-md-4">
          <label for="currency-code-input" class="required">Currency</label>
          <input is="iron-input" type="text" maxlength="3" bind-value="{{property.currencyCode}}" id="currency-code-input" class="form-control" required placeholder="Allowed Currency" />
        </div>


        <div class="form-group col-md-4">
          <label class="required">Available for booking?</label>
          <div class="checkbox">
            <label for="available-input"><input is="iron-input" bind-value="{{property.isBookingAvailable}}" type="checkbox" id="available-input" checked="{{property.isBookingAvailable}}" /> Booking Available</label> </div>
          </div>
      </div>

      <div class="col-md-12">
        <hr/>

        <div class="actions pull-right">

          <template is="dom-if" if="{{isEdit}}" restamp>
            <button type="button" class="btn btn-default" on-tap="_editCancelClicked">Cancel</button>
            <button type="submit" class="btn btn-primary">Save edits <span class="entypo check"></span></button>
          </template>

          <template is="dom-if" if="{{!isEdit}}" restamp>
            <button type="button" class="btn btn-default" on-tap="_createCancelClicked">Cancel</button>
            <button type="submit" class="btn btn-primary">Create property <span class="entypo circled-right"></span></button>
          </template>
        </div>

      </div>

    </form>

  </template>

  <script>

    var originalProperty = {};

    LLPropertyInformationEdit = Polymer({
      is: 'll-property-information-edit',

      factoryImpl: function(property, isEdit) {
        if(!property && isEdit) {
          throw new Error('Cannot be in edit mode without a property supplied');
        }

        this.property = property || {};
        this.isEdit = isEdit || false;
      },

      ready: function() {
        originalProperty = _.assign({}, this.property);
        this.$['post-form'].onsubmit = this._handlePost.bind(this);
      },

      /**
       * Fired when cancel button is clicked
       *
       * @event ll-property-information-edit-view-information
       */

      /**
       * Fired when Create button is clicked on edit form
       *
       * @event ll-property-information-edit-create-property
       */

      /**
       * Fired when Edit button is clicked on edit form
       *
       * @event ll-property-information-edit-post-edit
       */

      /**
       * Fired when Create button is clicked on create form
       *
       * @event ll-property-information-edit-post-create
       * @type {Object}
       * @property {Object} property - The property being mutated
       */

      properties: {
        /**
         * Existing property to edit
         * @default { location: {} }
         */
        property: {
          type: Object,
          reflectToAttribute: true,
          value: function() {
            return {
              location: {
                country: 'US'
              }
            };
          }
        },
        /**
         * Whether or not the view should render in edit mode from the @prop property
         * @default false
         */
        isEdit: {
          type: Boolean,
          value: false
        },
        _states: {
          type: Array,
          readOnly: true,
          value: function() {
            return ['AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ', 'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'];
          }
        }
      },
      _handlePost: function(e) {
        e.preventDefault();
        e.stopPropagation();
        if(this.isEdit) {
          this._postEditClicked(e);
        } else {
          this._postCreateClicked(e);
        }
      },
      _editCancelClicked: function() {
        this.property = originalProperty;
        this.fire('ll-property-information-edit-view-property', {property: this.property});
      },
      _createCancelClicked: function() {
        this.fire('ll-property-information-edit-back-to-properties');
      },
      _postEditClicked: function() {
        if(!this.isEdit) {
          throw new Error('Cannot post edit when not in edit mode');
        }
        this.fire('ll-property-information-edit-post-edit', {property: this.property});
      },
      _createPropertyClicked: function() {
        if(!this.isEdit) {
          throw new Error('Cannot view create mode when not in edit mode');
        }
        this.fire('ll-property-information-edit-create-property');
      },
      _postCreateClicked: function() {
        if(this.isEdit) {
          throw new Error('Cannot post create in edit mode');
        }
        this.fire('ll-property-information-edit-post-create', {property: this.property});
      },
      _computeDescription: function(description) {
        return description || '';
      },
      _isState: function(stateCode) {
        return (this.property && this.property.location)
            ? stateCode === this.property.location.subdivision
            : false;
      }
    });
  </script>

</dom-module>
